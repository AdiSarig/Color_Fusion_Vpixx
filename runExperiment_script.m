% % runExperiment_script%% clear allglobal debugdebug = 0; % set to 1 for a smaller screen (open screen is at: initPsychToolboxWindows_noCLUT)%%runPilotTest;analyze_pilotTest;selected_contrast = getInput('Enter the selected contrast level: ');%%rng('shuffle','twister');KbName('UnifyKeyNames');% run polyfit here (dummy) so that loaded into memory for laterpolyfit([1 2 3],[4 5 6],2);AssertOpenGL;                 % check for Opengl compatibility, abort otherwise%% Initialize VpixxisOpen = Datapixx('Open'); % check if Vpixx screen is connectedif ~isOpen    error('VIEWPixx not connected! Please check connection and try again');endPsychDataPixx('Open');% switch to ScanningBacklight mode for full illumination only after pixels stabilize PsychDataPixx('EnableVideoScanningBacklight'); % comment for photodiode testResponsePixx('Close'); % to make sure open doesn't failResponsePixx('Open');Datapixx('EnableDinDebounce');Datapixx('RegWr');% initialize digital outputDatapixx('SetDoutValues', 0);Datapixx('RegWr');WaitSecs(0.004);%%%for coding/testing purposes, session structure is loaded here, for running%actual participants/collecting data, uncoment lines 16-19%load subj001_PilotTest_20210719T114459.mat  % initialize the session structuresession = initSession('triangulation:DCM');% session.KEYS = getKeyBindings({'FACE','HOUSE','SEENOTHING','BRIFGLIMPSE','ALMOSTCLEAR','SUPERCLEAR','BLUEDOT'});% face-f house-h see nothing-1 brif glimpse-2 almost clear-3 superclear-4% this is easier for subjects to press the button% blue dot-space%% SAVE CODES% for each subject, we save all codes used for running the experiment[session] = saveCodes(session);%%disp('OK, press any key to begin...')%pause% run the screen calibration%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% You really only need to do this once every couple of weeks, assuming no% one touches the monitor settings in the interim.%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% run_calibration;% save(sprintf('subj%02d_sess%02d_lumFunc_%s.mat',session.subjnum,session.sessnum,datestr(now,30)),'p','P','beta'); %%%%% need to set the value for p once done all the pilot test% get default parameters% load subj00_sess00_lumFunc_20210827T155830.mat  % load subj222_sess222_lumFunc_20211110T111817.matsession.params = initParams(p, session);session.params.color.contrastLevel = selected_contrast;warning(['contrastLevel is set to ', num2str(selected_contrast)]);%% Uncomment only if not proceeded by the pilot test (contrast finding)% Check that the subject can fuse the stimuli% If fails after many attempts then send the subject home.% nAttemptsCheckFusion = CheckFusion;% train the subjects to view all stimuli at high color contrast. % % Contrast 15 preview% repeat_preview = true;% while repeat_preview%     trials_preview = runFaceHousePreview_15(session.params);%     repeat_preview = input('Was percentage below 90%? (1/0)');% end% % Contrast 13 preview% repeat_preview = true;% while repeat_preview%     trials_preview = runFaceHousePreview_13(session.params);%     repeat_preview = input('Was percentage below 90%? (1/0)');% end% % Contrast 11 preview% repeat_preview = true;% while repeat_preview%     trials_preview = runFaceHousePreview_11(session.params);%     repeat_preview = input('Was percentage below 90%? (1/0)');% end%%% WARNING: if you abort the preview you must reinitialize params before% running the main experiment!imgPath = 'stimRegular/';%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% RUN A FEW MINUTES OF BLUE_DOT TASK HERE% practiceTrials_script;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%cInd = session.params.color.contrastLevel;session.params.color.red = session.params.color.palette.reds(cInd,:);session.params.color.green = session.params.color.palette.greens(cInd,:);    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% fail safe backup of session structuresave(sprintf('subj%02d_sess%02d_%s_%s.mat',session.subjnum,...    session.sessnum,'session',datestr(now,30)),'session');oneSession_script%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% run the psychophysics testrunFaceHouseTest; % expects session.params to be defined%%%%%%%%%%%%%%%%%% final save of datasave(sprintf('..%cdata%csubj%02d_sess%02d_%s_%s.mat',filesep,filesep,session.subjnum,...    session.sessnum,'final',datestr(now,30)),'session'); disp('Done!')ResponsePixx('Close');Datapixx('Close');% All done!